# ------------------------
# Listener Configuration
# ------------------------
# Default MQTT port (TLS encrypted)
listener 1883
protocol mqtt

# Optional: WebSocket listener (if you use web clients)
listener 9001
protocol websockets

# Only allow authenticated clients
allow_anonymous true

# Authentication (username/password)
# password_file /mosquitto/config/passwords.txt

# ------------------------
# Persistence and Logging
# ------------------------
# Enable persistence so retained messages and subscriptions survive restarts
persistence true
persistence_location /mosquitto/data/persisted/

# Log settings
log_dest file /mosquitto/log/mosquitto.log
log_type error
log_type warning
log_type notice
log_type information
connection_messages true
log_timestamp true

# ------------------------
# TLS / SSL Configuration
# ------------------------
# Use valid certificates (self-signed or from a CA)
# You must mount these in via Docker volume or copy locally.
# cafile /mosquitto/config/certs/ca.crt
# certfile /mosquitto/config/certs/server.crt
# keyfile /mosquitto/config/certs/server.key

# Force clients to use TLS version 1.2 or higher
# tls_version tlsv1.2

# Optional: Require client certificates (mutual TLS)
# require_certificate true
# use_identity_as_username true

# ----------------
# Security Plugins
# ----------------
# If you use the dynamic security plugin (modern ACL/user management)
# Uncomment and configure:
# plugin /usr/lib/mosquitto_dynamic_security.so
# plugin_opt_config_file /mosquitto/config/dynamic-security.json

# ------------------------
# Access Control Lists (ACLs)
# ------------------------
# Fine-grained topic permissions
# acl_file /mosquitto/config/acl.txt

# Example ACL file (acl.txt):
# ---------------------------
# user sensor1
# topic readwrite sensors/1/#
#
# user admin
# topic readwrite #
# ---------------------------

# ---------------------------------
# Rate Limiting and Other Hardening
# ---------------------------------
# Limit message size (in bytes)
max_packet_size 10240000

# Limit retained messages per topic
max_inflight_messages 10

# Maximum QoS for untrusted clients
max_qos 2